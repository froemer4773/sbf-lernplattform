<div class="question-view-container">
  <!-- Gast-Modus Hinweis -->
  @if (!isAuthenticated()) {
    <div class="guest-notice">
      <span class="icon">‚ÑπÔ∏è</span>
      <span class="text">Sie lernen im Gast-Modus. <strong>Registrieren Sie sich</strong>, um Ihren Lernfortschritt, falsche Fragen und Zeiten zu speichern!</span>
      <button class="register-btn" (click)="goToRegister()">Jetzt registrieren</button>
    </div>
  }

  @if (error(); as errorMsg) {
    <div class="error-message">
      {{ errorMsg }}
      <button (click)="loadQuestions(schein(), kategorie())">Erneut versuchen</button>
    </div>
  }

  @if (loading()) {
    <div class="loading">
      <p>L√§dt Fragen...</p>
    </div>
  } @else {
    <div class="content">
      <!-- Question Card wie im Screenshot -->
      @if (currentQuestion(); as question) {
        <div class="question-card">
          <!-- Card Header mit Kategorie und Frage-Nummer -->
          <div class="card-header">
            <div class="category-badge">
              <span class="icon">üí¨</span>
              <span class="text">{{ schein() }} {{ kategorie() }}</span>
            </div>
            <div class="question-number">Frage {{ progress().current }} von {{ progress().total }}</div>
          </div>

          <!-- Frage Text -->
          <h2 class="question-title">{{ question.frage_text }}</h2>

          <!-- Frage Bild (falls vorhanden) -->
          @if (question.has_image) {
            <div class="question-image">
              <img [src]="apiService.getQuestionImageUrl(question.frage_id)" alt="Frage Bild" />
            </div>
          }

          <!-- Antwort-Optionen mit Radio Buttons -->
          <div class="answers-section">
            @for (answer of currentShuffledAnswers(); track answer.buchstabe) {
              <label class="answer-option"
                [class.selected]="getAnswerStatus(answer.buchstabe) === 'selected'"
                [class.correct]="revealed() && answer.ist_korrekt === 1"
                [class.incorrect]="revealed() && answer.ist_korrekt !== 1 && getAnswerStatus(answer.buchstabe) === 'selected'">
                <input
                  type="radio"
                  [value]="answer.buchstabe"
                  [checked]="getAnswerStatus(answer.buchstabe) === 'selected'"
                  (change)="selectAnswer(answer.buchstabe)"
                  name="answer"
                  [disabled]="revealed()"
                />
                <span class="answer-text">{{ answer.text }}</span>
              </label>
            }
          </div>          <!-- Hinweis Button (wie im Screenshot) -->
          <div class="hint-section">
            <button class="hint-button" (click)="toggleHint()">
              <span class="icon">‚ÑπÔ∏è</span>
              HINWEIS ANZEIGEN
              <span class="arrow">‚ñº</span>
            </button>
          </div>
        </div>

        <!-- Navigation Buttons unten (wie im Screenshot) -->
        <div class="bottom-navigation">
          <button
            [disabled]="currentQuestionIndex() === 0"
            (click)="previousQuestion()"
            class="nav-btn prev-btn"
          >
            <span class="arrow">‚Üê</span> VORHERIGE
          </button>
          <button
            (click)="onBack($event)"
            class="nav-btn back-btn"
          >
            ‚úï BEENDEN
          </button>
          <button
            (click)="revealAnswer()"
            class="nav-btn reveal-btn"
            [disabled]="revealed()"
          >
            ‚úì AUFDECKEN
          </button>
          @if (answerResults().length === questions().length && answerResults().length > 0) {
            <!-- Alle Fragen beantwortet: Zeige Ergebnisse-Button -->
            <button
              (click)="showResults()"
              class="nav-btn next-btn results-btn"
            >
              ERGEBNISSE ANZEIGEN <span class="arrow">‚Üí</span>
            </button>
          } @else {
            <!-- Noch nicht alle beantwortet: Zeige WEITER (submits answer) -->
            <button
              (click)="submitAnswer()"
              class="nav-btn next-btn"
            >
              WEITER <span class="arrow">‚Üí</span>
            </button>
          }
        </div>
      } @else {
        <div class="no-questions">
          <p>Keine Fragen verf√ºgbar</p>
          <a href="#" (click)="onBack($event)" class="btn btn-primary">
            Zur√ºck zur Kategorie-Auswahl
          </a>
        </div>
      }
    </div>
  }
</div>
