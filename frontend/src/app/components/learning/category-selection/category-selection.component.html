<div class="category-selection-container">
  <div class="header">
    <div class="header-content">
      <button class="back-button" (click)="goBack()">
        <span class="arrow">‚Üê</span> Zur√ºck zum Dashboard
      </button>
      <h1>W√§hlen Sie eine Kategorie</h1>
    </div>
  </div>

  @if (error(); as errorMsg) {
    <div class="error-message">
      {{ errorMsg }}
      <button (click)="loadLicenses()">Erneut versuchen</button>
    </div>
  }

  @if (loading()) {
    <div class="loading">
      <p>L√§dt Daten...</p>
    </div>
  } @else {
    <div class="content">
      <!-- Lizenz-Auswahl (falls mehrere) -->
      @if (licenses().length > 1) {
        <div class="licenses-section">
          <div class="licenses-grid">
            @for (license of licenses(); track license.name) {
              <button
                class="license-button"
                [class.active]="selectedLicense() === license.name"
                (click)="selectLicense(license)"
              >
                {{ license.name }}
              </button>
            }
          </div>
        </div>
      }

      <!-- Kategorien als Icon-Liste (wie im Screenshot) -->
      @if (categories().length > 0) {
        <div class="categories-section">
          <div class="categories-list">
            <!-- Falsch beantwortete Fragen (nur f√ºr eingeloggte User) -->
            @if (isAuthenticated()) {
              <a
                [routerLink]="['/learning/questions', selectedLicense(), 'alle']"
                [queryParams]="{filter: 'incorrect'}"
                class="category-item filter-option incorrect"
              >
                <div class="category-icon">
                  <span>‚ùå</span>
                </div>
                <div class="category-content">
                  <h3 class="category-title">Falsch beantwortete Fragen</h3>
                  <p class="category-subtitle">Alle falsch beantworteten Fragen</p>
                </div>
                <div class="category-arrow">
                  <span>‚Ä∫</span>
                </div>
              </a>

              <!-- Gemerkte Fragen -->
              <a
                [routerLink]="['/learning/questions', selectedLicense(), 'alle']"
                [queryParams]="{filter: 'bookmarked'}"
                class="category-item filter-option bookmarked"
              >
                <div class="category-icon">
                  <span>‚òÖ</span>
                </div>
                <div class="category-content">
                  <h3 class="category-title">Gemerkte Fragen</h3>
                  <p class="category-subtitle">Alle gemerkten Fragen</p>
                </div>
                <div class="category-arrow">
                  <span>‚Ä∫</span>
                </div>
              </a>
            }

            @for (category of categories(); track category.name) {
              <div
                class="category-item"
                [class.active]="selectedCategory() === category.name"
                (click)="selectCategory(category.name)"
              >
                <div class="category-icon">
                  <span>{{ getCategoryIcon(category.name) }}</span>
                </div>
                <div class="category-content">
                  <h3 class="category-title">{{ category.name }}</h3>
                  <p class="category-subtitle">{{ category.count }} Fragen</p>
                </div>
                <div class="category-arrow">
                  <span>‚Ä∫</span>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Unterkategorien (bei Auswahl einer Kategorie) -->
      @if (subcategories().length > 0) {
        <div class="subcategories-section">
          <h2>Unterkategorie w√§hlen</h2>
          <div class="subcategories-list">
            <!-- Alle Fragen Option -->
            <a
              [routerLink]="['/learning/questions', selectedLicense(), selectedCategory()]"
              class="subcategory-item all-option"
            >
              <div class="subcategory-icon">
                <span>üìö</span>
              </div>
              <div class="subcategory-content">
                <h3 class="subcategory-title">Alle Fragen</h3>
                <p class="subcategory-subtitle">{{ getTotalQuestionsForCategory() }} Fragen</p>
              </div>
              <div class="subcategory-arrow">
                <span>‚Ä∫</span>
              </div>
            </a>

            <!-- Individual Subcategories -->
            @for (subcategory of subcategories(); track subcategory.name) {
              <a
                [routerLink]="['/learning/questions', selectedLicense(), selectedCategory()]"
                [queryParams]="{unterkategorie: subcategory.name}"
                class="subcategory-item"
              >
                <div class="subcategory-icon">
                  <span>üìÑ</span>
                </div>
                <div class="subcategory-content">
                  <h3 class="subcategory-title">{{ subcategory.name }}</h3>
                  <p class="subcategory-subtitle">{{ subcategory.count }} Fragen</p>
                </div>
                <div class="subcategory-arrow">
                  <span>‚Ä∫</span>
                </div>
              </a>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
