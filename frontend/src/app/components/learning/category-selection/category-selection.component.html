<div class="category-selection-container">
  <div class="header">
    <a [routerLink]="['/dashboard']" class="back-link">← Zurück</a>
    <h1>Lernbereich</h1>
    <p>Wähle einen Führerschein und eine Kategorie zum Lernen</p>
  </div>

  @if (error(); as errorMsg) {
    <div class="error-message">
      {{ errorMsg }}
      <button (click)="loadLicenses()">Erneut versuchen</button>
    </div>
  }

  @if (loading()) {
    <div class="loading">
      <p>Lädt Daten...</p>
    </div>
  } @else {
    <div class="content">
      <!-- Lizenz-Auswahl -->
      <div class="licenses-section">
        <h2>Führerscheinart</h2>
        <div class="licenses-grid">
          @for (license of licenses(); track license.name) {
            <button
              class="license-button"
              [class.active]="selectedLicense() === license.name"
              (click)="selectLicense(license)"
            >
              {{ license.name }}
            </button>
          }
        </div>
      </div>

      <!-- Kategorien (Basisfragen) -->
      @if (categories().length > 0) {
        <div class="categories-section">
          <h2>Kategorie (Basisfragen)</h2>
          <div class="categories-grid">
            @for (category of categories(); track category.name) {
              <button
                class="category-card"
                [class.active]="selectedCategory() === category.name"
                (click)="selectCategory(category.name)"
              >
                <h3>{{ category.name }}</h3>
                <p class="question-count">{{ category.count }} Fragen</p>
              </button>
            }
          </div>
        </div>
      }

      <!-- Unterkategorien -->
      @if (subcategories().length > 0) {
        <div class="subcategories-section">
          <h2>Unterkategorie wählen</h2>
          <div class="categories-grid">
            <!-- Alle Option -->
            <a
              [routerLink]="['/learning/questions', selectedLicense(), selectedCategory()]"
              class="category-card all-option"
            >
              <h3>Alle</h3>
              <p class="question-count">{{ getTotalQuestionsForCategory() }} Fragen</p>
            </a>
            <!-- Individual Subcategories -->
            @for (subcategory of subcategories(); track subcategory.name) {
              <a
                [routerLink]="['/learning/questions', selectedLicense(), selectedCategory()]"
                [queryParams]="{unterkategorie: subcategory.name}"
                class="category-card"
              >
                <h3>{{ subcategory.name }}</h3>
                <p class="question-count">{{ subcategory.count }} Fragen</p>
              </a>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
